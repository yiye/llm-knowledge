# 开源项目研究规范 - Agent 工作指南

## 🎯 核心原则：忠于代码

**这是最重要的规则：所有分析、结论、说明都必须基于实际代码，绝不臆测。**

---

## 📜 工作准则

### 1. 忠于代码 🔥

- ✅ **读代码，不猜代码**：分析任何功能前，必须先阅读相关源代码
- ✅ **引用具体位置**：说明某个实现时，必须引用具体文件名和代码行号
- ✅ **基于事实**：只描述代码中实际存在的内容，不推测"可能"的实现
- ❌ **禁止臆测**：不要说"这个项目可能使用了XXX技术"，要说"在 `src/xxx.py:123` 中使用了XXX"
- ❌ **禁止模糊表述**："大概"、"应该"、"可能"等词汇在代码分析中是禁止的

**示例对比**：
```markdown
❌ 错误：这个项目可能使用了多线程来提升性能
✅ 正确：在 `train.py:456-478` 中使用了 `torch.multiprocessing` 实现多进程训练
```

---

### 2. 代码分析方法

**阅读顺序**（建议）：
1. **README/文档** → 了解项目定位和使用方式
2. **项目结构** → 梳理目录组织和模块划分
3. **入口文件** → 找到 `main.py`、`train.py` 等核心入口
4. **核心模块** → 深入关键算法实现
5. **配置文件** → 理解可调参数和默认设置

**分析重点**：
- 架构设计：模块如何组织？依赖关系如何？
- 核心算法：关键技术的具体实现方式
- 工程技巧：性能优化、错误处理、日志记录等
- 配置管理：如何管理超参数和环境配置
- 测试用例：如何保证代码质量

---

### 3. 研究笔记记录规范

#### 文档创建原则 🔥

**重要**：不要随意生成文档，只在用户明确要求时创建！

- ✅ **用户要求时**：明确说"创建 overview.md"、"写一份架构分析"
- ❌ **主动创建**：研究代码后自作主张创建笔记文档
- ✅ **增量记录**：用户让记录某个发现时，更新到现有笔记中
- ❌ **完整生成**：一次性生成 5 个笔记文件的完整模板

**正确流程**：
1. 研究代码 → 分析理解 → **等待用户指示**
2. 用户说"记录下来" → 询问写到哪个笔记 → 创建或更新
3. 用户说"给我总结" → 口头回答，不创建文件

#### 笔记目录结构

```
<project-name>/
  ├── <repo-name>/        # Git Submodule（源代码）
  └── notes/              # 研究笔记（按需创建）
      ├── overview.md         # 项目概览
      ├── architecture.md     # 架构分析
      ├── core-insights.md    # 核心发现
      └── code-reading-log.md # 代码阅读日志
```

#### 笔记内容要点

**overview.md**（项目概览）：
- 基本信息：地址、版本（commit hash / tag）、研究日期、主要语言
- 项目定位：来自 README 的官方定位
- 核心特点：3-5 个最重要的特点，引用具体代码位置
- 使用场景：解决什么问题

**architecture.md**（架构分析）：
- 目录结构：主要目录和文件职责
- 模块划分：核心模块及其职责
- 依赖关系：模块如何协作
- 数据流向：数据如何流转

**core-insights.md**（核心发现）：
- 关键技术点：实现位置、核心思路、代码片段、个人理解
- 巧妙设计：值得学习的工程实践
- 可改进之处：基于代码的优化方向

**code-reading-log.md**（代码阅读日志）：
- 按日期记录：阅读文件、主要内容、关键发现、疑问

---

### 4. 代码引用规范

**引用格式**：
```markdown
在 `DeepSpeed/deepspeed/runtime/engine.py:234-256` 中实现了 ZeRO-3：

\`\`\`python
# 引用实际代码片段
class DeepSpeedEngine:
    def __init__(self, ...):
        # ...
\`\`\`
```

**引用要求**：
- 必须包含**完整文件路径**（相对于 submodule 根目录，如 `DeepSpeed/deepspeed/...`）
- 必须包含**具体行号**或行号范围
- 代码片段要**完整可理解**，不要断章取义
- 如果代码太长，可以用 `# ...` 省略次要部分

---

### 5. 版本和时间标注

**研究时必须记录**：
- **Commit Hash**：研究的是哪个版本的代码
- **研究日期**：什么时候研究的
- **项目版本**：如果有 tag/release，标注版本号

**示例**：
```markdown
## 版本信息
- Commit: `a1b2c3d4e5f6...`
- Tag: `v1.2.3`
- 研究日期: 2026-01-28
- 注意：该分析基于 2026 年 1 月的代码，可能随版本更新而变化
```

---

### 6. 不确定信息处理

遇到不理解或不确定的地方：

```markdown
✅ 正确做法：
- 在 `DeepSpeed/deepspeed/runtime/config.py:45` 中有一个 `magic_number = 0.9` 参数
- 目前不清楚这个参数的具体作用，代码中没有注释说明
- 可能的方向：
  1. 查看相关 issue/PR 讨论
  2. 搜索论文中是否有说明
  3. 运行实验观察影响

❌ 错误做法：
- 这个参数可能是学习率衰减系数（没有依据的猜测）
```

---

## 🔧 Agent 工作流程

1. **接收任务**：用户想研究某个项目的某个方面
2. **定位代码**：使用 `Glob`、`Grep` 等工具找到相关文件
3. **阅读代码**：使用 `Read` 工具读取源代码
4. **分析理解**：基于实际代码进行分析
5. **记录笔记**：将发现记录到 `notes/<project>/` 对应文件中
6. **引用来源**：标注具体文件和行号

---

## 📊 质量标准

一份合格的研究笔记应该满足：

- [ ] 所有技术结论都有具体代码位置支撑
- [ ] 代码引用包含完整路径和行号
- [ ] 没有"可能"、"大概"、"应该"等模糊表述
- [ ] 标注了研究时的 commit hash 和日期
- [ ] 对不确定的地方明确标注"待研究"而非猜测
- [ ] 笔记组织清晰，便于后续查阅

---

## 🚫 明确禁止的行为

1. ❌ 不看代码就分析实现原理
2. ❌ 引用代码时不标注文件和行号
3. ❌ 基于印象或传闻描述项目特性
4. ❌ 将其他项目的做法套用到当前项目（除非代码确实如此）
5. ❌ 遇到不理解的地方编造解释

---

## ✨ 价值观

**我们研究代码的目标**：
- 学习优秀的工程实践
- 理解前沿技术的具体实现
- 积累真实可用的知识
- 建立可信赖的技术笔记库

**核心态度**：
- 忠于代码（基于事实）
- 严谨细致（不放过细节）
- 诚实记录（不懂就说不懂）
- 持续追踪（记录技术演进）

---

**记住：代码是最可靠的文档，我们要做代码的忠实记录者，而非想象力丰富的小说家。** 📖✨
