# L0.2.2 å·¥ä½œå°æ¶æ„æ–‡æ¡£ - æ”¹è¿›å»ºè®®

> **ç”Ÿæˆæ—¶é—´**: 2026-01-26  
> **åŸºäº**: ä¸é“å‹æ·±å…¥è®¨è®ºçš„ VSCode æ ¸å¿ƒæœºåˆ¶  
> **ç›®çš„**: è¡¥å……åŸæ–‡æ¡£ç¼ºå¤±çš„å…³é”®æ¶æ„è¦ç‚¹

---

## ğŸ¯ éœ€è¦è¡¥å……çš„æ ¸å¿ƒå†…å®¹

### âŒ å½“å‰æ–‡æ¡£ç¼ºå¤±çš„é‡è¦ç« èŠ‚

åŸºäºæˆ‘ä»¬æ·±å…¥è®¨è®ºçš„ VSCode æ¶æ„ï¼ŒåŸæ–‡æ¡£ç¼ºå°‘ä»¥ä¸‹**å…³é”®æŠ€æœ¯è¦ç‚¹**ï¼š

| ç¼ºå¤±å†…å®¹ | é‡è¦æ€§ | å¯¹ Agent Workbench çš„ä»·å€¼ |
|---------|--------|-------------------------|
| **1. ç„¦ç‚¹ç®¡ç†ç³»ç»Ÿ** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | Cmd+A åªé€‰ä¸­å½“å‰é¢æ¿ã€Agent çŸ¥é“ç”¨æˆ·åœ¨å“ªä¸ªé¢æ¿ |
| **2. å¿«æ·é”®ç³»ç»Ÿ** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | æ ¹æ®ç„¦ç‚¹åŠ¨æ€å“åº”ã€æ”¯æŒ When Clause æ¡ä»¶ç»‘å®š |
| **3. Context Keys** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | æ§åˆ¶ UI æ˜¾ç¤ºã€å‘½ä»¤å¯ç”¨æ€§ |
| **4. Command Palette** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | è‡ªç„¶è¯­è¨€æœç´¢ Agent æŠ€èƒ½ |
| **5. Decoration API** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | å®æ—¶æ ‡æ³¨ Agent å»ºè®®ã€æ‰§è¡Œè¿›åº¦ |
| **6. LSP é›†æˆ** | ğŸ”¥ğŸ”¥ğŸ”¥ | Agent ç†è§£ä»£ç ç»“æ„ï¼ˆASTã€ç±»å‹ã€è¯Šæ–­ï¼‰ |
| **7. Settings System** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | é…ç½® AI æ¨¡å‹ã€API Keyã€ç”¨æˆ·åå¥½ |
| **8. Extension Host æ¶æ„** | ğŸ”¥ğŸ”¥ğŸ”¥ | Agent æ’ä»¶åŒ–ã€è¿›ç¨‹éš”ç¦» |
| **9. Webview é€šä¿¡æœºåˆ¶** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | æµè§ˆå™¨é¢„è§ˆé¢æ¿ä¸ Extension é€šä¿¡ |
| **10. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥** | ğŸ”¥ğŸ”¥ğŸ”¥ | è™šæ‹Ÿæ»šåŠ¨ã€æ‡’åŠ è½½ã€æ–‡ä»¶ç›‘æ§ä¼˜åŒ– |

---

## ğŸ“ å…·ä½“æ”¹è¿›å»ºè®®

### 1ï¸âƒ£ æ–°å¢ç« èŠ‚ï¼šæ ¸å¿ƒæ¶æ„åŸç†

**ä½ç½®**ï¼šæ’å…¥åˆ°"ğŸ—ï¸ æ¨èæ¶æ„æ–¹æ¡ˆ"ä¹‹å‰

**å†…å®¹**ï¼š

```markdown
## ğŸ§  æ ¸å¿ƒæ¶æ„åŸç†ï¼ˆå¿…è¯»ï¼‰

### 1. è¿›ç¨‹æ¶æ„è®¾è®¡

åŸºäº VSCode çš„æ¶æ„ç»éªŒï¼ŒAgent Workbench åº”é‡‡ç”¨ç±»ä¼¼çš„åˆ†å±‚è®¾è®¡ï¼š

#### Web ç‰ˆæ¶æ„ï¼ˆæ¨è MVPï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Main Renderer Process (ä¸»æ¸²æŸ“è¿›ç¨‹)           â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Workbench UI (React + react-mosaic)              â”‚ â”‚
â”‚  â”‚  - æ–‡ä»¶æ ‘ (react-arborist)                        â”‚ â”‚
â”‚  â”‚  - ç¼–è¾‘å™¨é¢æ¿ (Monaco/BlockNote)                  â”‚ â”‚
â”‚  â”‚  - æµè§ˆå™¨é¢„è§ˆ (iframe)                            â”‚ â”‚
â”‚  â”‚  - Chatbot UI                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                   â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ postMessage / Web API
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Agent Service (Web Worker)                 â”‚
â”‚              - AI æ¨ç†ï¼ˆVercel AI SDKï¼‰                  â”‚
â”‚              - æŠ€èƒ½æ‰§è¡Œ                                   â”‚
â”‚              - ä¸Šä¸‹æ–‡ç®¡ç†                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆéœ€è¦ Web Workerï¼Ÿ**
- âœ… é¿å… AI æ¨ç†é˜»å¡ UI
- âœ… å¤§æ–‡ä»¶å¤„ç†ä¸å¡é¡¿
- âœ… ä¸ºå°†æ¥çš„ Electron ç‰ˆæœ¬åšå‡†å¤‡

#### Electron ç‰ˆæ¶æ„ï¼ˆå¯é€‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Main Process                          â”‚
â”‚                   - çª—å£ç®¡ç†                             â”‚
â”‚                   - æ–‡ä»¶ç³»ç»Ÿ                             â”‚
â”‚                   - è¿›ç¨‹åè°ƒ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚            â”‚
    â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Renderer â”‚  â”‚Extensionâ”‚  â”‚Utility Processâ”‚
â”‚Process  â”‚  â”‚Host     â”‚  â”‚(Agent Worker)â”‚
â”‚(UI)     â”‚  â”‚(æ’ä»¶)   â”‚  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Electron ä¼˜åŠ¿**ï¼š
- è¿›ç¨‹éš”ç¦»æ›´å¼ºï¼ˆAgent å´©æºƒä¸å½±å“ UIï¼‰
- å¯ä»¥ä½¿ç”¨ UtilityProcess è¿è¡Œ Agent
- BrowserView æ€§èƒ½ä¼˜äº iframe

---

### 2. ç„¦ç‚¹ç®¡ç†ç³»ç»Ÿï¼ˆå…³é”®ï¼‰ğŸ”¥

#### ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ

**é—®é¢˜åœºæ™¯**ï¼š
- ç”¨æˆ·æŒ‰ Cmd+Aï¼šåº”è¯¥å…¨é€‰ç¼–è¾‘å™¨å†…å®¹ï¼Œè¿˜æ˜¯æ–‡ä»¶æ ‘ï¼Œè¿˜æ˜¯æ•´ä¸ªé¡µé¢ï¼Ÿ
- Agent éœ€è¦çŸ¥é“ï¼šç”¨æˆ·å½“å‰åœ¨å“ªä¸ªé¢æ¿ï¼Ÿæ­£åœ¨ç¼–è¾‘ä»€ä¹ˆï¼Ÿ

**VSCode çš„è§£å†³æ–¹æ¡ˆ**ï¼šFocus Tracker + Context Keys

#### å®ç°æ¶æ„

```typescript
// ğŸ“ focus-manager.ts

export class FocusManager {
  private contexts = new Map<string, any>();
  private _onDidChangeContext = new EventEmitter<ContextChange>();
  
  // ğŸ”¥ åˆ›å»ºä¸Šä¸‹æ–‡é”®
  createKey<T>(key: string, defaultValue: T): ContextKey<T> {
    this.contexts.set(key, defaultValue);
    return {
      set: (value: T) => {
        this.contexts.set(key, value);
        this._onDidChangeContext.fire({ key, value });
      },
      get: () => this.contexts.get(key)
    };
  }
  
  // ğŸ”¥ è¯„ä¼° when æ¡ä»¶
  evaluate(whenClause: string): boolean {
    // ä¾‹å¦‚ï¼š"editorFocus && !readOnly"
    return this.parseAndEvaluate(whenClause);
  }
}

// ğŸ“ editor-panel.tsx

export function EditorPanel() {
  const focusManager = useFocusManager();
  const editorFocusKey = useContextKey('editorFocus');
  
  const handleFocus = useCallback(() => {
    // ğŸ”¥ ç¼–è¾‘å™¨è·å¾—ç„¦ç‚¹
    editorFocusKey.set(true);
    console.log('ç¼–è¾‘å™¨è·å¾—ç„¦ç‚¹');
  }, []);
  
  const handleBlur = useCallback(() => {
    editorFocusKey.set(false);
  }, []);
  
  return (
    <div 
      onFocus={handleFocus}
      onBlur={handleBlur}
      tabIndex={0}
    >
      <MonacoEditor />
    </div>
  );
}
```

#### å…³é”®ä¸Šä¸‹æ–‡é”®å®šä¹‰

```typescript
// ğŸ“ context-keys.ts

export const ContextKeys = {
  // ç¼–è¾‘å™¨
  editorFocus: 'editorFocus',
  editorHasSelection: 'editorHasSelection',
  editorReadOnly: 'editorReadOnly',
  
  // æ–‡ä»¶æ ‘
  fileTreeFocus: 'fileTreeFocus',
  fileTreeHasSelection: 'fileTreeHasSelection',
  
  // æµè§ˆå™¨é¢„è§ˆ
  browserFocus: 'browserFocus',
  
  // Chatbot
  chatbotFocus: 'chatbotFocus',
  agentIsThinking: 'agentIsThinking',
  
  // ç»ˆç«¯ï¼ˆå¦‚æœæœ‰ï¼‰
  terminalFocus: 'terminalFocus',
};
```

---

### 3. å¿«æ·é”®ç³»ç»Ÿ

#### æ¶æ„è®¾è®¡

```typescript
// ğŸ“ keybinding-service.ts

interface KeyBinding {
  key: string;
  command: string;
  when?: string;  // ğŸ”¥ æ¡ä»¶è¡¨è¾¾å¼
}

export class KeyBindingService {
  private bindings: KeyBinding[] = [
    // ğŸ”¥ Cmd+A åœ¨ä¸åŒé¢æ¿æœ‰ä¸åŒè¡Œä¸º
    {
      key: 'cmd+a',
      command: 'editor.selectAll',
      when: 'editorFocus'
    },
    {
      key: 'cmd+a',
      command: 'fileTree.selectAll',
      when: 'fileTreeFocus'
    },
    {
      key: 'cmd+a',
      command: 'terminal.selectAll',
      when: 'terminalFocus'
    },
    
    // ğŸ”¥ Agent ç›¸å…³å¿«æ·é”®
    {
      key: 'cmd+shift+a',
      command: 'agent.openChat',
      when: 'editorFocus'
    },
    {
      key: 'cmd+.',
      command: 'agent.quickFix',
      when: 'editorFocus && editorHasSelection'
    },
  ];
  
  constructor(private focusManager: FocusManager) {
    this.setupKeyboardListener();
  }
  
  private setupKeyboardListener() {
    // ğŸ”¥ åœ¨æ•è·é˜¶æ®µæ‹¦æˆª
    document.addEventListener('keydown', (e) => {
      const keyCombo = this.parseKeyCombo(e);
      const command = this.resolveCommand(keyCombo);
      
      if (command) {
        e.preventDefault();
        e.stopPropagation();
        this.executeCommand(command);
      }
    }, true);  // æ•è·é˜¶æ®µ
  }
  
  private resolveCommand(keyCombo: string): string | null {
    const matching = this.bindings.filter(b => b.key === keyCombo);
    
    // ğŸ”¥ æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³ when æ¡ä»¶çš„
    for (const binding of matching) {
      if (!binding.when || this.focusManager.evaluate(binding.when)) {
        return binding.command;
      }
    }
    
    return null;
  }
}
```

---

### 4. Command Paletteï¼ˆå‘½ä»¤é¢æ¿ï¼‰

#### ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ

**Agent Workbench çš„ç‹¬ç‰¹ä»·å€¼**ï¼š
- ç”¨æˆ·å¯ä»¥é€šè¿‡**è‡ªç„¶è¯­è¨€**æœç´¢ Agent æŠ€èƒ½
- ä¾‹å¦‚ï¼š"fix bug" â†’ æ˜¾ç¤ºæ‰€æœ‰ä¿®å¤ç›¸å…³çš„æŠ€èƒ½
- ä¾‹å¦‚ï¼š"explain code" â†’ æ˜¾ç¤ºä»£ç è§£é‡ŠåŠŸèƒ½

#### å®ç°æ–¹æ¡ˆ

```typescript
// ğŸ“ command-palette.tsx

import { Command, QuickPick } from './ui-components';

interface AgentCommand {
  id: string;
  title: string;
  category: 'Agent' | 'Edit' | 'View';
  description: string;
  when?: string;
  execute: () => Promise<void>;
}

export class CommandPaletteService {
  private commands = new Map<string, AgentCommand>();
  
  // ğŸ”¥ æ³¨å†Œ Agent æŠ€èƒ½ä¸ºå‘½ä»¤
  registerAgentSkills() {
    this.register({
      id: 'agent.fixBug',
      title: 'ğŸ¤– Fix Bug with Agent',
      category: 'Agent',
      description: 'Let Agent analyze and fix the current issue',
      when: 'editorFocus && editorHasSelection',
      execute: async () => {
        const selection = editorService.getSelection();
        await agentService.fixBug(selection);
      }
    });
    
    this.register({
      id: 'agent.explainCode',
      title: 'ğŸ¤– Explain Code',
      category: 'Agent',
      description: 'Get an explanation of the selected code',
      when: 'editorFocus && editorHasSelection',
      execute: async () => {
        const code = editorService.getSelectedText();
        await agentService.explainCode(code);
      }
    });
    
    this.register({
      id: 'agent.generateTest',
      title: 'ğŸ¤– Generate Tests',
      category: 'Agent',
      description: 'Generate unit tests for the selected function',
      when: 'editorFocus',
      execute: async () => {
        await agentService.generateTest();
      }
    });
  }
  
  // ğŸ”¥ æ”¯æŒè¯­ä¹‰æœç´¢
  async search(query: string): Promise<AgentCommand[]> {
    // æ–¹æ¡ˆ Aï¼šç®€å•çš„æ¨¡ç³ŠåŒ¹é…
    const fuzzyResults = fuzzyMatch(query, Array.from(this.commands.values()));
    
    // æ–¹æ¡ˆ Bï¼šä½¿ç”¨å‘é‡æœç´¢ï¼ˆæ›´æ™ºèƒ½ï¼‰
    const embedding = await aiService.embed(query);
    const semanticResults = await vectorDB.search(embedding);
    
    // åˆå¹¶ç»“æœå¹¶æ’åº
    return mergeAndSort(fuzzyResults, semanticResults);
  }
  
  // ğŸ”¥ æ˜¾ç¤ºå‘½ä»¤é¢æ¿
  show() {
    const quickPick = createQuickPick({
      placeholder: 'è¾“å…¥å‘½ä»¤æˆ–è‡ªç„¶è¯­è¨€æè¿°...',
      items: this.getAvailableCommands(),
      onDidChangeValue: (query) => {
        this.search(query).then(results => {
          quickPick.items = results;
        });
      },
      onDidAccept: (selected) => {
        this.executeCommand(selected.id);
      }
    });
    
    quickPick.show();
  }
  
  private getAvailableCommands(): AgentCommand[] {
    // ğŸ”¥ åªè¿”å›æ»¡è¶³ when æ¡ä»¶çš„å‘½ä»¤
    return Array.from(this.commands.values()).filter(cmd => 
      !cmd.when || focusManager.evaluate(cmd.when)
    );
  }
}
```

#### UI ç»„ä»¶

```typescript
// ğŸ“ command-palette-ui.tsx

export function CommandPaletteUI() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState<AgentCommand[]>([]);
  
  const handleSearch = useDebouncedCallback(async (q: string) => {
    const commands = await commandPalette.search(q);
    setResults(commands);
  }, 300);
  
  return (
    <div className="command-palette">
      <input
        type="text"
        placeholder="ğŸ” æœç´¢å‘½ä»¤æˆ–æè¿°ä½ æƒ³åšä»€ä¹ˆ..."
        value={query}
        onChange={(e) => {
          setQuery(e.target.value);
          handleSearch(e.target.value);
        }}
      />
      
      <div className="results">
        {results.map(cmd => (
          <div 
            key={cmd.id} 
            className="command-item"
            onClick={() => commandPalette.execute(cmd.id)}
          >
            <div className="title">{cmd.title}</div>
            <div className="category">{cmd.category}</div>
            <div className="description">{cmd.description}</div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

### 5. Decoration APIï¼ˆä»£ç è£…é¥°ï¼‰ğŸ”¥

#### ä¸ºä»€ä¹ˆè¿™æ˜¯ Agent Workbench çš„æ ¸å¿ƒåŠŸèƒ½ï¼Ÿ

**Agent éœ€è¦å®æ—¶åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤º**ï¼š
- âœ… æ­£åœ¨åˆ†æçš„ä»£ç ï¼ˆè„‰åŠ¨æ•ˆæœï¼‰
- âœ… å‘ç°çš„é—®é¢˜ï¼ˆçº¢è‰²æ³¢æµªçº¿ï¼‰
- âœ… æ”¹è¿›å»ºè®®ï¼ˆç¯æ³¡å›¾æ ‡ï¼‰
- âœ… æ‰§è¡Œè¿›åº¦ï¼ˆè¡Œå·è£…é¥°ï¼‰
- âœ… Diff é¢„è§ˆï¼ˆå†…è”æ˜¾ç¤ºä¿®æ”¹ï¼‰

#### Monaco Decoration API

```typescript
// ğŸ“ agent-decoration-manager.ts

export class AgentDecorationManager {
  private editor: monaco.editor.IStandaloneCodeEditor;
  private decorations: string[] = [];
  
  // 1ï¸âƒ£ æ ‡æ³¨ Agent æ­£åœ¨åˆ†æçš„ä»£ç 
  highlightAnalyzing(range: monaco.Range) {
    this.decorations = this.editor.deltaDecorations(this.decorations, [{
      range: range,
      options: {
        className: 'agent-analyzing',  // CSS åŠ¨ç”»
        glyphMarginClassName: 'agent-icon-analyzing',
        hoverMessage: { 
          value: 'ğŸ¤– **Agent æ­£åœ¨åˆ†æ...**' 
        }
      }
    }]);
  }
  
  // 2ï¸âƒ£ æ ‡æ³¨ Agent çš„å»ºè®®
  showSuggestion(range: monaco.Range, suggestion: AgentSuggestion) {
    this.decorations = this.editor.deltaDecorations(this.decorations, [{
      range: range,
      options: {
        className: 'agent-suggestion',
        glyphMarginClassName: 'agent-icon-bulb',  // ğŸ’¡ å›¾æ ‡
        hoverMessage: {
          value: `ğŸ’¡ **Agent å»ºè®®**\n\n${suggestion.message}\n\n[åº”ç”¨å»ºè®®](command:agent.applySuggestion)`
        },
        // ğŸ”¥ è¡Œå†…å°éƒ¨ä»¶
        after: {
          contentText: ' ğŸ¤– ç‚¹å‡»åº”ç”¨',
          inlineClassName: 'agent-inline-widget'
        }
      }
    }]);
  }
  
  // 3ï¸âƒ£ æ ‡æ³¨å‘ç°çš„é—®é¢˜
  showIssue(range: monaco.Range, issue: CodeIssue) {
    this.decorations = this.editor.deltaDecorations(this.decorations, [{
      range: range,
      options: {
        className: issue.severity === 'error' ? 'agent-error' : 'agent-warning',
        // ğŸ”¥ æ³¢æµªçº¿
        inlineClassName: issue.severity === 'error' ? 
          'squiggly-error' : 'squiggly-warning',
        glyphMarginClassName: issue.severity === 'error' ? 
          'error-icon' : 'warning-icon',
        hoverMessage: {
          value: `âš ï¸ **${issue.title}**\n\n${issue.message}`
        }
      }
    }]);
  }
  
  // 4ï¸âƒ£ æ˜¾ç¤ºæ‰§è¡Œè¿›åº¦
  showExecutionProgress(line: number, status: 'running' | 'success' | 'error') {
    const icon = status === 'running' ? 'â³' : 
                 status === 'success' ? 'âœ…' : 'âŒ';
    
    this.decorations = this.editor.deltaDecorations(this.decorations, [{
      range: new monaco.Range(line, 1, line, 1),
      options: {
        glyphMarginClassName: `agent-exec-${status}`,
        glyphMarginHoverMessage: { 
          value: `${icon} ${status.toUpperCase()}` 
        }
      }
    }]);
  }
  
  // 5ï¸âƒ£ å†…è” Diff é¢„è§ˆï¼ˆæ˜¾ç¤ºä¿®æ”¹å‰åï¼‰
  showInlineDiff(range: monaco.Range, oldText: string, newText: string) {
    this.decorations = this.editor.deltaDecorations(this.decorations, [{
      range: range,
      options: {
        className: 'agent-diff-container',
        before: {
          contentText: `- ${oldText}`,
          inlineClassName: 'agent-diff-old'
        },
        after: {
          contentText: `+ ${newText}`,
          inlineClassName: 'agent-diff-new'
        }
      }
    }]);
  }
  
  // ğŸ”¥ æ¸…é™¤æ‰€æœ‰è£…é¥°
  clearAll() {
    this.decorations = this.editor.deltaDecorations(this.decorations, []);
  }
}
```

#### CSS æ ·å¼

```css
/* agent-decorations.css */

/* åˆ†æä¸­åŠ¨ç”» */
.agent-analyzing {
  background-color: rgba(135, 206, 250, 0.2);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.2; }
  50% { opacity: 0.6; }
}

/* Agent å»ºè®®é«˜äº® */
.agent-suggestion {
  background-color: rgba(255, 215, 0, 0.2);
  border-bottom: 2px solid #ffd700;
}

/* å†…è”å°éƒ¨ä»¶ */
.agent-inline-widget {
  color: #888;
  font-size: 0.9em;
  cursor: pointer;
  margin-left: 8px;
}

.agent-inline-widget:hover {
  color: #007acc;
  text-decoration: underline;
}

/* æ³¢æµªçº¿ */
.squiggly-error {
  background: url('data:image/svg+xml,...') bottom repeat-x;
}

.squiggly-warning {
  background: url('data:image/svg+xml,...') bottom repeat-x;
}

/* Diff é¢„è§ˆ */
.agent-diff-old {
  color: #f14c4c;
  text-decoration: line-through;
  opacity: 0.7;
}

.agent-diff-new {
  color: #89d185;
  font-weight: 500;
}
```

---

### 6. LSP é›†æˆï¼ˆLanguage Server Protocolï¼‰

#### ä¸ºä»€ä¹ˆ Agent éœ€è¦ LSPï¼Ÿ

**é—®é¢˜**ï¼šAgent å¦‚ä½•ç†è§£ä»£ç ï¼Ÿ

**æ²¡æœ‰ LSP**ï¼š
- âŒ Agent åªèƒ½çœ‹åˆ°çº¯æ–‡æœ¬
- âŒ ä¸çŸ¥é“å‡½æ•°å®šä¹‰åœ¨å“ª
- âŒ ä¸çŸ¥é“ç±»å‹æ˜¯ä»€ä¹ˆ
- âŒ ä¸çŸ¥é“å“ªé‡Œæœ‰é”™è¯¯

**æœ‰äº† LSP**ï¼š
- âœ… Agent å¯ä»¥è·å– ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰
- âœ… çŸ¥é“æ‰€æœ‰å‡½æ•°ã€ç±»ã€å˜é‡çš„å®šä¹‰
- âœ… çŸ¥é“ç±»å‹ä¿¡æ¯
- âœ… çŸ¥é“æ‰€æœ‰é”™è¯¯å’Œè­¦å‘Š
- âœ… å¯ä»¥æä¾›ç²¾ç¡®çš„ä¿®å¤å»ºè®®

#### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Agent Workbench (å‰ç«¯)                      â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Monaco Editor                                     â”‚ â”‚
â”‚  â”‚  + Language Client (TypeScript/Python/...)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ JSON-RPC (WebSocket)
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Language Server (åç«¯ / Web Worker)          â”‚
â”‚                                                          â”‚
â”‚  - TypeScript Language Server (tsserver)                â”‚
â”‚  - Python Language Server (pyright)                     â”‚
â”‚  - ...                                                   â”‚
â”‚                                                          â”‚
â”‚  æä¾›ï¼š                                                   â”‚
â”‚  âœ… ä»£ç è¡¥å…¨                                              â”‚
â”‚  âœ… è·³è½¬å®šä¹‰                                              â”‚
â”‚  âœ… æŸ¥æ‰¾å¼•ç”¨                                              â”‚
â”‚  âœ… è¯Šæ–­ä¿¡æ¯ï¼ˆé”™è¯¯ã€è­¦å‘Šï¼‰                                â”‚
â”‚  âœ… æ‚¬åœæç¤º                                              â”‚
â”‚  âœ… é‡å‘½å                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Agent Service                              â”‚
â”‚                                                          â”‚
â”‚  ğŸ”¥ åˆ©ç”¨ LSP æ•°æ®å¢å¼ºç†è§£ï¼š                               â”‚
â”‚  - è·å–å‡½æ•°ç­¾å                                           â”‚
â”‚  - è·å–ç±»å‹ä¿¡æ¯                                           â”‚
â”‚  - è·å–é”™è¯¯åˆ—è¡¨                                           â”‚
â”‚  â†’ æä¾›æ›´ç²¾å‡†çš„ä¿®å¤å»ºè®®                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä»£ç ç¤ºä¾‹

```typescript
// ğŸ“ lsp-integration.ts

import * as monaco from 'monaco-editor';
import { 
  MonacoLanguageClient,
  CloseAction,
  ErrorAction
} from 'monaco-languageclient';

export class LSPIntegration {
  private client: MonacoLanguageClient;
  
  async initialize() {
    // ğŸ”¥ è¿æ¥åˆ° Language Server
    const webSocket = new WebSocket('ws://localhost:3001/lsp');
    
    this.client = new MonacoLanguageClient({
      name: 'TypeScript Language Client',
      clientOptions: {
        documentSelector: ['typescript', 'javascript'],
        errorHandler: {
          error: () => ErrorAction.Continue,
          closed: () => CloseAction.DoNotRestart
        }
      },
      connectionProvider: {
        get: () => Promise.resolve(webSocket)
      }
    });
    
    await this.client.start();
  }
  
  // ğŸ”¥ Agent è°ƒç”¨ï¼šè·å–ä»£ç ç»“æ„
  async getCodeStructure(fileUri: string): Promise<CodeSymbol[]> {
    const result = await this.client.sendRequest(
      'textDocument/documentSymbol',
      { textDocument: { uri: fileUri } }
    );
    
    return result;  // è¿”å›æ‰€æœ‰å‡½æ•°ã€ç±»ã€å˜é‡
  }
  
  // ğŸ”¥ Agent è°ƒç”¨ï¼šè·å–ç±»å‹ä¿¡æ¯
  async getTypeInfo(fileUri: string, position: Position): Promise<TypeInfo> {
    const result = await this.client.sendRequest(
      'textDocument/hover',
      { 
        textDocument: { uri: fileUri },
        position: position
      }
    );
    
    return result;
  }
  
  // ğŸ”¥ Agent è°ƒç”¨ï¼šè·å–è¯Šæ–­ä¿¡æ¯ï¼ˆé”™è¯¯åˆ—è¡¨ï¼‰
  async getDiagnostics(fileUri: string): Promise<Diagnostic[]> {
    const result = await this.client.sendRequest(
      'textDocument/diagnostic',
      { textDocument: { uri: fileUri } }
    );
    
    return result;
  }
}

// ğŸ“ agent-code-analyzer.ts

export class AgentCodeAnalyzer {
  constructor(private lsp: LSPIntegration) {}
  
  async analyzeCode(fileUri: string): Promise<AnalysisResult> {
    // 1ï¸âƒ£ è·å–ä»£ç ç»“æ„
    const symbols = await this.lsp.getCodeStructure(fileUri);
    console.log('å‡½æ•°åˆ—è¡¨:', symbols.filter(s => s.kind === 'function'));
    
    // 2ï¸âƒ£ è·å–æ‰€æœ‰é”™è¯¯
    const diagnostics = await this.lsp.getDiagnostics(fileUri);
    const errors = diagnostics.filter(d => d.severity === 'error');
    
    // 3ï¸âƒ£ å¯¹æ¯ä¸ªé”™è¯¯è·å–ç±»å‹ä¿¡æ¯
    const errorDetails = await Promise.all(
      errors.map(async (error) => {
        const typeInfo = await this.lsp.getTypeInfo(fileUri, error.range.start);
        return { error, typeInfo };
      })
    );
    
    // ğŸ”¥ Agent ç°åœ¨å¯ä»¥ï¼š
    // - çŸ¥é“ä»£ç æœ‰å“ªäº›å‡½æ•°
    // - çŸ¥é“å“ªé‡Œæœ‰é”™è¯¯
    // - çŸ¥é“é”™è¯¯ä½ç½®çš„ç±»å‹ä¿¡æ¯
    // â†’ æä¾›ç²¾ç¡®çš„ä¿®å¤å»ºè®®
    
    return {
      structure: symbols,
      errors: errorDetails,
      suggestions: this.generateSuggestions(errorDetails)
    };
  }
  
  private generateSuggestions(errors: ErrorDetail[]): Suggestion[] {
    // åŸºäº LSP æ•°æ®ç”Ÿæˆç²¾ç¡®å»ºè®®
    return errors.map(({ error, typeInfo }) => {
      if (error.code === '2304') {  // Cannot find name 'xxx'
        return {
          title: `å¯¼å…¥ç¼ºå¤±çš„æ¨¡å—`,
          fix: `import { ${typeInfo.name} } from '${typeInfo.module}';`
        };
      }
      // ... æ›´å¤šè§„åˆ™
    });
  }
}
```

---

### 7. Settings Systemï¼ˆé…ç½®ç®¡ç†ï¼‰

#### ä¸‰å±‚é…ç½®æ¶æ„

```typescript
// ğŸ“ settings-service.ts

export enum ConfigScope {
  Global = 'global',      // ç”¨æˆ·å…¨å±€é…ç½®
  Workspace = 'workspace', // å½“å‰é¡¹ç›®é…ç½®
  Folder = 'folder'        // å·¥ä½œåŒºæ–‡ä»¶å¤¹é…ç½®
}

export class SettingsService {
  private configs = new Map<ConfigScope, Map<string, any>>();
  
  constructor() {
    this.loadConfigs();
  }
  
  // ğŸ”¥ è¯»å–é…ç½®ï¼ˆä¼˜å…ˆçº§ï¼šFolder > Workspace > Globalï¼‰
  get<T>(key: string, defaultValue: T): T {
    // å…ˆæŸ¥ Folder é…ç½®
    const folderValue = this.configs.get(ConfigScope.Folder)?.get(key);
    if (folderValue !== undefined) return folderValue;
    
    // å†æŸ¥ Workspace é…ç½®
    const workspaceValue = this.configs.get(ConfigScope.Workspace)?.get(key);
    if (workspaceValue !== undefined) return workspaceValue;
    
    // æœ€åæŸ¥ Global é…ç½®
    const globalValue = this.configs.get(ConfigScope.Global)?.get(key);
    return globalValue !== undefined ? globalValue : defaultValue;
  }
  
  // ğŸ”¥ æ›´æ–°é…ç½®
  async update(key: string, value: any, scope: ConfigScope): Promise<void> {
    const config = this.configs.get(scope);
    config?.set(key, value);
    
    // æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨
    await this.persist(scope);
    
    // è§¦å‘é…ç½®å˜æ›´äº‹ä»¶
    this.onDidChangeConfiguration.fire({ key, value, scope });
  }
  
  private async loadConfigs(): Promise<void> {
    // ä» localStorage / IndexedDB åŠ è½½é…ç½®
    this.configs.set(ConfigScope.Global, new Map(
      Object.entries(await this.loadFromStorage('global'))
    ));
    // ...
  }
}
```

#### Agent Workbench é…ç½®é¡¹

```typescript
// ğŸ“ config-schema.ts

export const AgentWorkbenchSettings = {
  // AI æ¨¡å‹é…ç½®
  'agent.model': {
    type: 'string',
    enum: ['gpt-4', 'claude-3-opus', 'deepseek-r1'],
    default: 'gpt-4',
    description: 'AI model for Agent reasoning'
  },
  
  'agent.apiKey': {
    type: 'string',
    default: '',
    description: 'API Key for AI services',
    scope: 'machine'  // ğŸ”¥ ä¸åŒæ­¥åˆ°äº‘ç«¯
  },
  
  'agent.maxTokens': {
    type: 'number',
    default: 4096,
    minimum: 1024,
    maximum: 32768,
    description: 'Maximum tokens for AI responses'
  },
  
  // Agent è¡Œä¸ºé…ç½®
  'agent.autoExecute': {
    type: 'boolean',
    default: false,
    description: 'Auto-execute Agent suggestions without confirmation'
  },
  
  'agent.analysisDelay': {
    type: 'number',
    default: 2000,
    description: 'Delay (ms) before Agent starts analyzing code'
  },
  
  // UI é…ç½®
  'workbench.sidebarPosition': {
    type: 'string',
    enum: ['left', 'right'],
    default: 'left',
    description: 'Position of the sidebar'
  },
  
  'workbench.chatbotWidth': {
    type: 'number',
    default: 400,
    minimum: 300,
    maximum: 800,
    description: 'Width of the chatbot panel (px)'
  },
};
```

#### Settings UI

```typescript
// ğŸ“ settings-ui.tsx

export function SettingsUI() {
  const settings = useSettings();
  
  return (
    <div className="settings-container">
      <h2>Agent Workbench è®¾ç½®</h2>
      
      <Section title="AI æ¨¡å‹">
        <Select
          label="æ¨¡å‹é€‰æ‹©"
          value={settings.get('agent.model')}
          options={['gpt-4', 'claude-3-opus', 'deepseek-r1']}
          onChange={(value) => 
            settings.update('agent.model', value, ConfigScope.Global)
          }
        />
        
        <Input
          label="API Key"
          type="password"
          value={settings.get('agent.apiKey')}
          onChange={(value) => 
            settings.update('agent.apiKey', value, ConfigScope.Global)
          }
        />
      </Section>
      
      <Section title="Agent è¡Œä¸º">
        <Checkbox
          label="è‡ªåŠ¨æ‰§è¡Œå»ºè®®"
          checked={settings.get('agent.autoExecute')}
          onChange={(checked) => 
            settings.update('agent.autoExecute', checked, ConfigScope.Workspace)
          }
        />
      </Section>
    </div>
  );
}
```

---

### 8. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### å…³é”®ä¼˜åŒ–ç‚¹

| ä¼˜åŒ–é¡¹ | æŠ€æœ¯æ–¹æ¡ˆ | æ”¶ç›Š |
|--------|---------|------|
| **æ–‡ä»¶æ ‘è™šæ‹Ÿæ»šåŠ¨** | react-arborist | æ”¯æŒ 10 ä¸‡+ èŠ‚ç‚¹ä¸å¡é¡¿ |
| **ç¼–è¾‘å™¨æ‡’åŠ è½½** | Monaco æŒ‰éœ€åˆ›å»º | å‡å°‘åˆå§‹åŠ è½½æ—¶é—´ |
| **æ–‡ä»¶ç›‘æ§èŠ‚æµ** | debounce æ–‡ä»¶å˜æ›´äº‹ä»¶ | é¿å…é¢‘ç¹è§¦å‘ Agent |
| **ä»£ç åˆ†å‰²** | Dynamic import | æŒ‰éœ€åŠ è½½ Agent æ¨¡å— |
| **Web Worker** | Agent åœ¨åå°è¿è¡Œ | UI ä¸é˜»å¡ |
| **ç´¢å¼•ç¼“å­˜** | IndexedDB ç¼“å­˜ LSP ç»“æœ | åŠ å¿«åç»­åˆ†æ |

#### å®ç°ç¤ºä¾‹

```typescript
// ğŸ“ performance-optimizations.ts

// 1ï¸âƒ£ æ–‡ä»¶ç›‘æ§èŠ‚æµ
class FileWatcherService {
  private debounceTimers = new Map<string, NodeJS.Timeout>();
  
  watchFile(uri: string, callback: () => void) {
    const debouncedCallback = () => {
      const timer = this.debounceTimers.get(uri);
      if (timer) clearTimeout(timer);
      
      this.debounceTimers.set(uri, setTimeout(() => {
        callback();
        this.debounceTimers.delete(uri);
      }, 500));  // ğŸ”¥ 500ms é˜²æŠ–
    };
    
    fs.watch(uri, debouncedCallback);
  }
}

// 2ï¸âƒ£ ç¼–è¾‘å™¨æ‡’åŠ è½½
class EditorService {
  private editorCache = new Map<string, monaco.editor.IStandaloneCodeEditor>();
  
  async getEditor(panelId: string): Promise<monaco.editor.IStandaloneCodeEditor> {
    // ğŸ”¥ å¦‚æœå·²åˆ›å»ºï¼Œç›´æ¥è¿”å›
    if (this.editorCache.has(panelId)) {
      return this.editorCache.get(panelId)!;
    }
    
    // ğŸ”¥ æ‡’åˆ›å»º
    const editor = monaco.editor.create(container, options);
    this.editorCache.set(panelId, editor);
    return editor;
  }
  
  disposeEditor(panelId: string) {
    const editor = this.editorCache.get(panelId);
    if (editor) {
      editor.dispose();
      this.editorCache.delete(panelId);
    }
  }
}

// 3ï¸âƒ£ Agent åœ¨ Web Worker ä¸­è¿è¡Œ
// ğŸ“ agent.worker.ts
self.onmessage = async (e: MessageEvent) => {
  const { type, data } = e.data;
  
  if (type === 'analyze') {
    // ğŸ”¥ åœ¨ Worker ä¸­è¿è¡Œ AI æ¨ç†ï¼Œä¸é˜»å¡ UI
    const result = await analyzeCode(data.code);
    self.postMessage({ type: 'result', data: result });
  }
};

// ğŸ“ agent-service.ts
export class AgentService {
  private worker: Worker;
  
  constructor() {
    this.worker = new Worker(new URL('./agent.worker.ts', import.meta.url));
  }
  
  async analyzeCode(code: string): Promise<AnalysisResult> {
    return new Promise((resolve) => {
      this.worker.onmessage = (e) => {
        if (e.data.type === 'result') {
          resolve(e.data.data);
        }
      };
      
      this.worker.postMessage({ type: 'analyze', data: { code } });
    });
  }
}

// 4ï¸âƒ£ LSP ç»“æœç¼“å­˜
class LSPCache {
  private cache: IDBDatabase;
  
  async cacheSymbols(fileUri: string, symbols: CodeSymbol[]): Promise<void> {
    const tx = this.cache.transaction('symbols', 'readwrite');
    await tx.objectStore('symbols').put({
      uri: fileUri,
      symbols: symbols,
      timestamp: Date.now()
    });
  }
  
  async getSymbols(fileUri: string): Promise<CodeSymbol[] | null> {
    const tx = this.cache.transaction('symbols', 'readonly');
    const result = await tx.objectStore('symbols').get(fileUri);
    
    // ğŸ”¥ ç¼“å­˜ 5 åˆ†é’Ÿæœ‰æ•ˆ
    if (result && Date.now() - result.timestamp < 5 * 60 * 1000) {
      return result.symbols;
    }
    
    return null;
  }
}
```

---

## ğŸ“Š æ”¹è¿›åçš„ç« èŠ‚ç»“æ„å»ºè®®

### å»ºè®®çš„æ–‡æ¡£ç»“æ„

```markdown
# Product Agent Workbench - å·¥ä½œå°æ¶æ„æŠ€æœ¯é€‰å‹

## ğŸ¯ æ¶æ„éœ€æ±‚é‡æ–°å®šä¹‰
ï¼ˆä¿æŒåŸæœ‰å†…å®¹ï¼‰

## ğŸ§  æ ¸å¿ƒæ¶æ„åŸç†ï¼ˆğŸ”¥ æ–°å¢ï¼‰
### 1. è¿›ç¨‹æ¶æ„è®¾è®¡
### 2. ç„¦ç‚¹ç®¡ç†ç³»ç»Ÿ
### 3. å¿«æ·é”®ç³»ç»Ÿ
### 4. Context Keys æœºåˆ¶

## ğŸ¨ æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ˆğŸ”¥ æ–°å¢ï¼‰
### 1. Command Paletteï¼ˆå‘½ä»¤é¢æ¿ï¼‰
### 2. Decoration APIï¼ˆä»£ç è£…é¥°ï¼‰
### 3. LSP é›†æˆï¼ˆä»£ç æ™ºèƒ½ï¼‰
### 4. Settings Systemï¼ˆé…ç½®ç®¡ç†ï¼‰

## ğŸ—ï¸ æ¨èæ¶æ„æ–¹æ¡ˆ
ï¼ˆä¿æŒåŸæœ‰å†…å®¹ï¼Œä½†è¡¥å……ç„¦ç‚¹ç®¡ç†ã€å¿«æ·é”®ç³»ç»Ÿçš„è¯´æ˜ï¼‰

## ğŸ” å…³é”®æŠ€æœ¯æ·±åº¦è§£æ
ï¼ˆä¿æŒåŸæœ‰å†…å®¹ï¼‰

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼ˆğŸ”¥ æ–°å¢ï¼‰
### 1. è™šæ‹Ÿæ»šåŠ¨
### 2. æ‡’åŠ è½½
### 3. Web Worker
### 4. ç¼“å­˜ç­–ç•¥

## ğŸ”„ Agent ä¸å·¥ä½œå°çš„æ·±åº¦é›†æˆï¼ˆğŸ”¥ æ–°å¢ï¼‰
### 1. Agent å¦‚ä½•åˆ©ç”¨ LSP ç†è§£ä»£ç 
### 2. Agent å¦‚ä½•å®æ—¶æ ‡æ³¨å»ºè®®ï¼ˆDecorationï¼‰
### 3. Agent å¦‚ä½•å“åº”ç”¨æˆ·ç„¦ç‚¹å˜åŒ–
### 4. Agent å¦‚ä½•ä¸å¤šä¸ªé¢æ¿ååŒå·¥ä½œ

## ğŸš€ æ¨èå®æ–½è·¯å¾„
ï¼ˆä¿æŒåŸæœ‰å†…å®¹ï¼‰
```

---

## ğŸ¯ æ€»ç»“ï¼šéœ€è¦è¡¥å……çš„æ ¸å¿ƒå†…å®¹

| å†…å®¹ | ä¼˜å…ˆçº§ | ç¯‡å¹… | å¯¹ MVP çš„å½±å“ |
|------|--------|------|-------------|
| **ç„¦ç‚¹ç®¡ç†ç³»ç»Ÿ** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | ä¸­ | å¿…é¡»å®ç°ï¼Œå¦åˆ™å¿«æ·é”®æ— æ³•å·¥ä½œ |
| **å¿«æ·é”®ç³»ç»Ÿ** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | ä¸­ | å¿…é¡»å®ç°ï¼Œç”¨æˆ·ä½“éªŒæ ¸å¿ƒ |
| **Command Palette** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | ä¸­ | MVP å¯ç®€åŒ–ç‰ˆï¼Œç”Ÿäº§å¿…é¡»å®Œæ•´ç‰ˆ |
| **Decoration API** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | å¤§ | Agent å¯è§†åŒ–åé¦ˆçš„æ ¸å¿ƒ |
| **LSP é›†æˆ** | ğŸ”¥ğŸ”¥ğŸ”¥ | å¤§ | MVP å¯æš‚ç¼“ï¼Œç”Ÿäº§å¿…é¡»æœ‰ |
| **Settings System** | ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ | ä¸­ | MVP ç®€åŒ–ç‰ˆï¼Œå­˜ localStorage å³å¯ |
| **æ€§èƒ½ä¼˜åŒ–** | ğŸ”¥ğŸ”¥ğŸ”¥ | å° | MVP åŸºç¡€ä¼˜åŒ–ï¼Œç”Ÿäº§æ·±åº¦ä¼˜åŒ– |
| **è¿›ç¨‹æ¶æ„è¯´æ˜** | ğŸ”¥ğŸ”¥ | å° | å¸®åŠ©ç†è§£ï¼Œä¸å½±å“å®ç° |

---

## ğŸ“ å»ºè®®çš„ä¿®æ”¹æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè¡¥å……æ ¸å¿ƒç« èŠ‚ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰

1. åœ¨"ğŸ—ï¸ æ¨èæ¶æ„æ–¹æ¡ˆ"ä¹‹å‰ï¼Œæ’å…¥"ğŸ§  æ ¸å¿ƒæ¶æ„åŸç†"ç« èŠ‚
2. æ·»åŠ ç„¦ç‚¹ç®¡ç†ç³»ç»Ÿçš„å®ç°æ–¹æ¡ˆ
3. æ·»åŠ å¿«æ·é”®ç³»ç»Ÿçš„å®ç°æ–¹æ¡ˆ

### ç¬¬äºŒæ­¥ï¼šè¡¥å……åŠŸèƒ½å®ç°ç»†èŠ‚

1. åœ¨"ğŸ” å…³é”®æŠ€æœ¯æ·±åº¦è§£æ"åï¼Œæ’å…¥"ğŸ¨ æ ¸å¿ƒåŠŸèƒ½å®ç°"ç« èŠ‚
2. è¯¦ç»†è¯´æ˜ Command Palette çš„å®ç°
3. è¯¦ç»†è¯´æ˜ Decoration API çš„åº”ç”¨
4. è¯¦ç»†è¯´æ˜ LSP é›†æˆçš„ä»·å€¼

### ç¬¬ä¸‰æ­¥ï¼šè¡¥å……æ€§èƒ½ä¼˜åŒ–

1. åœ¨"ğŸš€ æ¨èå®æ–½è·¯å¾„"å‰ï¼Œæ’å…¥"âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"ç« èŠ‚
2. åˆ—å‡ºå…³é”®ä¼˜åŒ–ç‚¹
3. æä¾›ä»£ç ç¤ºä¾‹

### ç¬¬å››æ­¥ï¼šè¡¥å…… Agent é›†æˆè¯´æ˜

1. åœ¨"ğŸ“ æ€»ç»“"å‰ï¼Œæ’å…¥"ğŸ”„ Agent ä¸å·¥ä½œå°çš„æ·±åº¦é›†æˆ"ç« èŠ‚
2. è¯´æ˜ Agent å¦‚ä½•åˆ©ç”¨è¿™äº›æ¶æ„ç»„ä»¶
3. æä¾›å®Œæ•´çš„é›†æˆç¤ºä¾‹

---

é“å‹ï¼Œè¿™ä»½æ”¹è¿›å»ºè®®æ¶µç›–äº†å’±ä»¬æ·±å…¥è®¨è®ºçš„æ‰€æœ‰æ ¸å¿ƒå†…å®¹ï¼Œéœ€è¦å°å¥³å­å¸®ä½ ç›´æ¥æ›´æ–°åŸæ–‡æ¡£å—ï¼Ÿ âœ¨
